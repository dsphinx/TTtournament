<div class="container mt-5">
  <h2 class="mb-4">Επεξεργασία Παίκτη</h2>
  <div id="form-response" class="mb-3"></div>

  <form id="editForm" method="POST">
    <input type="hidden" name="id" id="playerId">
    <input type="hidden" name="action" id="update" value="update">
    <input type="hidden" name="tbl" id="athletes" value="athletes">

    <div class="mb-3">
      <label for="surname" class="form-label">Επώνυμο</label>
      <input type="text" name="surname" id="surname" class="form-control" maxlength="30" required>
    </div>

    <div class="mb-3">
      <label for="name" class="form-label">Όνομα</label>
      <input type="text" name="name" id="name" class="form-control" maxlength="20" required>
    </div>

    <div class="mb-3">
      <label for="yearDOB" class="form-label">Έτος Γέννησης</label>
      <input type="text" name="yearDOB" id="yearDOB" class="form-control" maxlength="4" required>
    </div>

    <div class="mb-3">
      <label for="arithmoisdeltiou" class="form-label">Αριθμός Δελτίου</label>
      <input type="number" name="arithmoisdeltiou" id="arithmoisdeltiou" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="email" class="form-label">Email</label>
      <input type="email" name="email" id="email" class="form-control">
    </div>

    <div class="mb-3">
      <label for="notes" class="form-label">Σημειώσεις</label>
      <textarea name="notes" id="notes" class="form-control" rows="3"></textarea>
    </div>

    <div class="mb-3">
      <label for="veteran" class="form-label">Βετεράνος</label>
      <select name="veteran" id="veteran" class="form-select">
        <option value="0">Όχι</option>
        <option value="1">Ναι</option>
      </select>
    </div>

    <button type="submit" class="btn btn-primary">Αποθήκευση Αλλαγών</button>
  </form>
</div>

<script>
  $(document).ready(function () {
    const urlParams = new URLSearchParams(window.location.search);
    const playerId = urlParams.get('id');

    if (playerId) {
      $.ajax({
        url: 'App/TTennisCalls.php?action=get&tbl=athletes&id='+playerId,
        type: 'GET',
        dataType: 'json',  // ✅ προσθέτουμε αυτό
        data: { id: playerId },
        success: function (athlete) {
          $('#playerId').val(athlete.id);
          $('#surname').val(athlete.surname);
          $('#name').val(athlete.name);
          $('#yearDOB').val(athlete.yearDOB);
          $('#arithmoisdeltiou').val(athlete.arithmoisdeltiou);
          $('#email').val(athlete.email);
          $('#notes').val(athlete.notes);
          $('#veteran').val(athlete.veteran);
        },
        error: function () {
          $('#form-response').html('<div class="alert alert-danger">Αποτυχία φόρτωσης παίκτη.</div>');
        }
      });
    }

    $('#editForm').submit(function (e) {
      e.preventDefault();

      const formData = $(this).serialize();

      $.ajax({
        url: 'App/TTennisCalls.php?action=update&tbl=athletes&id='+playerId,
        type: 'POST',
        data: formData,
        success: function () {
          $('#form-response').html('<div class="alert alert-success">Οι αλλαγές αποθηκεύτηκαν!</div>');
        },
        error: function () {
          $('#form-response').html('<div class="alert alert-danger">Σφάλμα κατά την αποθήκευση.</div>');
        }
      });
    });
  });
</script>
